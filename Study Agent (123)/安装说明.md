# Study Agent 依赖安装说明

## 问题诊断

根据检查，你遇到了以下问题：

1. **虚拟环境未激活**：`uvicorn` 命令找不到，因为依赖安装在虚拟环境中，但当前终端使用的是系统 Python
2. **pip 配置问题**：pip 配置中设置了 `no-index='1'`，阻止了从 PyPI 下载包
3. **代理连接问题**：可能存在代理配置导致连接失败

## 解决方案

### 方法一：使用提供的启动脚本（推荐）

**Windows PowerShell：**
```powershell
# 1. 打开 PowerShell，进入项目目录
cd "c:\Users\Qin\Desktop\Study Agent (123)"

# 2. 运行启动脚本（会自动处理虚拟环境和依赖安装）
.\setup_and_run.ps1
```

**Windows CMD：**
```cmd
# 双击运行 启动服务.bat 文件
# 或者在 CMD 中执行：
cd "c:\Users\Qin\Desktop\Study Agent (123)"
启动服务.bat
```

### 方法二：手动安装（如果脚本不工作）

#### 步骤 1：激活虚拟环境

**PowerShell：**
```powershell
cd "c:\Users\Qin\Desktop\Study Agent (123)"
.\.venv\Scripts\Activate.ps1
```

**CMD：**
```cmd
cd "c:\Users\Qin\Desktop\Study Agent (123)"
.venv\Scripts\activate.bat
```

激活成功后，命令行提示符前会显示 `(.venv)`。

#### 步骤 2：清除 pip 配置问题

检查并清除 pip 配置中的 `no-index` 设置：

```powershell
# 查看当前配置
pip config list

# 如果看到 no-index='1'，需要清除它
# 方法：编辑或删除配置文件
# 配置文件位置：C:\Users\Qin\AppData\Roaming\pip\pip.ini
```

或者临时禁用：
```powershell
$env:PIP_NO_INDEX = ""
```

#### 步骤 3：清除代理设置（如果有问题）

```powershell
$env:HTTP_PROXY = ""
$env:HTTPS_PROXY = ""
$env:http_proxy = ""
$env:https_proxy = ""
```

#### 步骤 4：使用国内镜像源安装依赖

```powershell
# 使用清华镜像源
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt

# 或者使用阿里云镜像源
pip install -i https://mirrors.aliyun.com/pypi/simple/ -r requirements.txt

# 或者使用豆瓣镜像源
pip install -i https://pypi.douban.com/simple/ -r requirements.txt
```

#### 步骤 5：验证安装

```powershell
pip list | Select-String -Pattern "fastapi|uvicorn|httpx|pydantic"
```

应该看到类似输出：
```
fastapi    0.x.x
uvicorn    0.x.x
httpx      0.x.x
pydantic   2.x.x
```

#### 步骤 6：启动服务

```powershell
uvicorn app.main:app --reload
```

## 常见问题

### Q1: 提示 "无法加载文件，因为在此系统上禁止运行脚本"

**解决方案：**
```powershell
# 以管理员身份运行 PowerShell，执行：
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Q2: 仍然无法连接 PyPI

**解决方案：**
1. 检查网络连接
2. 尝试使用不同的镜像源（清华、阿里云、豆瓣）
3. 检查防火墙设置
4. 如果使用公司网络，可能需要配置代理

### Q3: 某些包安装失败（如 faiss-cpu）

**解决方案：**
- `faiss-cpu` 在某些环境下可能安装困难，可以先注释掉，后续再安装
- 或者使用 conda 安装：`conda install -c conda-forge faiss-cpu`

### Q4: Python 版本问题

当前虚拟环境使用 Python 3.13.9，如果遇到兼容性问题，可以重新创建虚拟环境：

```powershell
# 删除旧环境
Remove-Item -Recurse -Force .venv

# 使用 Python 3.11 或 3.12 创建新环境（如果已安装）
python3.11 -m venv .venv
# 或
python3.12 -m venv .venv
```

## 快速检查清单

- [ ] 虚拟环境已创建（`.venv` 文件夹存在）
- [ ] 虚拟环境已激活（命令行前有 `(.venv)` 提示）
- [ ] pip 配置正常（`pip config list` 中没有 `no-index='1'`）
- [ ] 网络连接正常（可以访问镜像源）
- [ ] 核心依赖已安装（fastapi, uvicorn, httpx, pydantic）
- [ ] 可以运行 `uvicorn app.main:app --reload`

## 获取帮助

如果以上方法都无法解决问题，请提供：
1. Python 版本：`python --version`
2. pip 版本：`pip --version`
3. pip 配置：`pip config list`
4. 错误信息完整输出
